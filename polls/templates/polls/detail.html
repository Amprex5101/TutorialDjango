{% extends "polls/base.html" %}

{% block title %}Detalle de Encuesta{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 offset-md-2">
        <div class="card">
            {% if user.is_authenticated and ya_voto == false %}
            <div class="card-header">
                <h1>{{ question.question_text }}</h1>
            </div>
            {% endif %}
            <div class="card-body">
                {% if error_message %}
                <div class="alert alert-danger">
                    <strong>{{ error_message }}</strong>
                </div> 
                
                {% endif %}
                
                {% if not is_active %}
                <div class="alert alert-warning">
                    Esta encuesta ya no est치 disponible para votar.
                    {% if question.end_date %}
                    <small class="d-block mt-1">
                        Finaliz칩 el {{ question.end_date|date:"d/m/Y" }} a las {{ question.end_date|time:"H:i" }}
                    </small>
                    {% endif %}
                </div>
                {% endif %}
                
                {% if user.is_authenticated %}
                    {% if ya_voto %}
                        <div class="alert alert-info">
                            Ya has votado en esta encuesta. Tu elecci칩n fue: 
                            <strong>{{ opcion_seleccionada.choice_text }}</strong>
                            <small class="d-block mt-1">
                                Votaste el {{ fecha_voto|date:"d/m/Y" }} a las {{ fecha_voto|time:"H:i" }}
                            </small>
                        </div>
                        <a href="{% url 'polls:results' question.id %}" class="btn btn-primary">Ver resultados</a>
                    {% elif is_active %}
                        <form action="{% url 'polls:vote' question.id %}" method="post">
                            {% csrf_token %}
                            <fieldset>
                                {% for choice in question.choice_set.all %}
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="choice" 
                                        id="choice{{ forloop.counter }}" value="{{ choice.id }}">
                                    <label class="form-check-label" for="choice{{ forloop.counter }}">
                                        {{ choice.choice_text }}
                                    </label>
                                </div>
                                {% endfor %}
                            </fieldset>
                            <button type="submit" class="btn btn-primary mt-3">Votar</button>
                        </form>
                    {% endif %}
                {% else %}
                    {% if is_active %}
                        <div class="alert alert-warning">
                            Debes <a href="{% url 'polls:login' %}">iniciar sesi칩n</a> para poder votar.
                        </div>
                    {% endif %}                    
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}